{% extends 'blog/blog.html' %}
{% load comment_tags %}
{% load likes_tags %}
{% load staticfiles %}
{% load highlight %}
{% load post_tags %}
{#页面标题#}
{% block title %}
    搜索:{{ key }}
{% endblock title %}

{% block lunbobox %}{% endblock %}

{% block header_extend %}
    <style>
        span.highlighted { color: red; }
    </style>
    <link rel="stylesheet" href="{% static 'blog/css/blog.css' %}">
{% endblock %}
{% block nav_search_active %}active_tag{% endblock %}

{% block content %}
    {% if query %}

        <div class="container" style="margin-top: 80px">
            <div class="row">

                <div class="col-xs-12 col-sm-8 col-md-9">

                    {# post_list|length是一种过滤器,过滤的结果为post_list的长度 #}
                    {% for result in page.object_list %}
                        <div class="blog-border">
                            <div class="blog-item">
                                {# post.id把主键传递出去,在views中就可以找到该post的body,urls中也能规则匹配 #}{# 在反向解析中,注意格式{% url 'namespace:name' para %} #}
                                <div class="blog-title">
                                        <a href="{% url 'blog:detail' result.object.id %}">
                                            {% highlight result.object.title with query %}
                                        </a>
                                </div>

                                <div class="blog-describe">{{ result.object.body|cut:'&nbsp;'|striptags|truncatechars:150|safe}}</div>

                                <div>{# <span>中的是分类和时间logo样式 #}
                                    <div class="blog-tags">

                                        <span class="glyphicon glyphicon-time"></span>&nbsp;{{ result.object.created_time|date:"Y-m-d" }}&nbsp;&nbsp;&nbsp;

                                        分类：<a href="{% url 'blog:category' result.object.category.id %}">
                                            {{ result.object.category }}
                                        </a>&nbsp;&nbsp;&nbsp;

                                        阅读：{{ result.object.get_read_num }}&nbsp;&nbsp;&nbsp;

                                        评论：{% get_comment_count result.object %}&nbsp;&nbsp;&nbsp;

                                        推荐：<a onclick="likeChange(this, '{% get_content_type result.object %}', {{ result.object.id }})">
                                                <span class="glyphicon glyphicon-thumbs-up {% get_like_status result.object %}"></span>
                                                <span class="liked-num">{% get_like_count result.object %}</span>
                                             </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                            <div class="no-find">
                                非常抱歉，没有检索您想要的内容，换个关键词再试试 ？
                                <p style="margin-top: 2em">
                                    <a href="{% url 'blog:home' %}">返回首页</a>
                                </p>
                            </div>
                        {% endfor %}
                <div class="paginator">
                    <ul class="pagination">
                        <li>
                            {# 上一页 #}
                            {% if page.has_previous %}
                                <a href="?q={{ query }}&page={{ page.previous_page_number }}" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            {% else %}
                                <span aria-hidden="true">&laquo;</span>
                            {% endif %}
                        </li>
                        {# 全部页码 #}
                        {# {% for page_num in page_of_list.paginator.page_range %}#}
                        {# page_range在views中被处理成当前页数+-2的范围,目的是为了避免页码过于长#}
                        {% for page_num in page_range %}
                            {# 判断是否当前页 #}
                            {% if page_num == page.number %}
                                {# 如果是当前页就设置active高亮 #}
                                <li class="active"><a href="?q={{ query }}&page={{ page_num }}">{{ page_num }}</a></li>
                            {% else %}
                                {% if page_num == '...' %}
                                    <li><span>{{ page_num }}</span></li>
                                {% else %}
                                    <li><a href="?q={{ query }}&page={{ page_num }}">{{ page_num }}</a></li>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <li>
                        {# 下一页 #}
                        {% if page.has_next %}
                            <a href="?q={{ query }}&page={{ page.next_page_number }}" aria-label="Previous">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        {% else %}
                            <span aria-hidden="true">&raquo;</span>
                            </li>
                        {% endif %}
                    </ul>
                    <ul class="pagination">
                        <li id="page_goto"><span><input type="text" value="6"></span></li>
                        <li><a href="javascript:void(0);" onclick="page_jump();">Go</a></li>
                    </ul>
                    <p>
                        共有{{ page.paginator.count }}篇博客,
                        当前第{{ page.number }}页, 共{{ page.paginator.num_pages }}页
                    </p>
                </div>
            </div>


                <div class="hidden-xs col-sm-4 col-md-3 blog-border">
                    <div class="side-list">
                        <h4><span class="glyphicon glyphicon-fire"></span>&nbsp;热门阅读</h4>
                        <ul>
                            {% for hot_data in all_hot_posts %}
                                <div class="light-item">
                                    <a href="{% url 'blog:detail' hot_data.id %}" target="_Blank">{{ hot_data.title|striptags|truncatechars:30|safe }}</a>
                                </div>
                            {% empty %}
                                暂无总榜 !
                            {% endfor %}
                        </ul>
                    </div>

                    <div class="side-list">
                        <h4><span class="glyphicon glyphicon-random"></span>&nbsp;&nbsp;随机推荐</h4>
                        <ul>
                            {% for post in random_recommend %}
                                <li class="light-item">
                                    <a href="{% url 'blog:detail' post.id %}" target="_Blank">{{ post }}</a>
                                </li>
                            {% empty %}
                                暂无推荐 !
                            {% endfor %}
                        </ul>
                    </div>

                    <div class="side-list">
                        <h4><span class="glyphicon glyphicon-time"></span>&nbsp;最新推荐</h4>
                        <ul>
                            {% for post in new_recommend %}
                                <li class="light-item">
                                    <a href="{% url 'blog:detail' post.content_object.id %}" target="_Blank">{{ post.content_object.title }}</a>
                                </li>
                            {% empty %}
                                暂无推荐 ！
                            {% endfor %}
                        </ul>
                    </div>
                </div>

            </div>
        </div>

    {% endif %}
    <script>
            // 翻页
            function page_goto(page){
                if(page==''){
                    page = 1;
                }
                var reg = /page=\d{0,2}/;
                var url = window.location.href;

                //判断是否有参数
                if(reg.test(window.location.href)){
                    url = url.replace(reg, 'page=' + page);
                }else if(url.indexOf("?") == -1){
                    url = url + '?page=' + page;
                }else{
                    url = url + '&page=' + page;
                }
                //重定向
                window.location.href = url;
            }
            function page_jump(){
                var page = $("#page_goto input[type=text]")[0].value;
                page_goto(page);
            }
        </script>
{% endblock %}

